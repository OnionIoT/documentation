---
title: Bluetooth
slug: /networking/bluetooth
description: Complete guide for enabling and configuring the built-in Bluetooth controller on Omega4 devices, including installation, pairing, and troubleshooting.
---



# Bluetooth Bring-Up & Usage Guide

Omega4 includes Bluetooth 5.0 (AIC8800D80) with BLE and Classic support in central and peripheral roles. Use it for:
- BLE sensor or beacon gateways that forward data over Wi-Fi or Ethernet.
- Device setup/provisioning flows with a companion mobile app.
- Low-power accessories like keyboards, barcode scanners, or remote controls.

This guide covers enabling and exercising the built-in Bluetooth controller on Omega4 devices.

## 1. Prerequisites

1. **Firmware & driver**  
   - Ensure the `kmod-aic8800d-sdio` kernel module is built into the image (included since FW v0.0.2).  
   - Confirm the controller enumerates as `hci0` under `/sys/class/bluetooth/`.

2. **Networking**  
   - The steps below download packages from the standard OpenWrt feeds. Make sure the Omega4 has WAN access (or mirror the packages locally).

## 2. Install User-Space Bluetooth Stack

```sh
opkg update
opkg install \
    bluez-daemon \
    bluez-utils \
    bluez-utils-extra \
    bluez-tools
```

This pulls in `bluetoothd`, CLI helpers (`bluetoothctl`, `hciconfig`, etc.), and required libraries (`dbus`, `glib2`, `libreadline`, â€¦).

## 3. Verify the Controller

1. List controllers:
   ```sh
   ls /sys/class/bluetooth
   # Expect: hci0
   ```
2. Inspect capabilities:
   ```sh
   hciconfig -a
   ```
   Confirm `Type: Primary  Bus: SDIO`, `UP RUNNING`, and matching BD_ADDR.

If the interface shows `DOWN`, bring it up:
```sh
hciconfig hci0 up
```

## 4. Start the Bluetooth Daemon

The init script is shipped as `/etc/init.d/bluetoothd`.

```sh
/etc/init.d/bluetoothd start      # start once
/etc/init.d/bluetoothd enable     # optional: autostart on boot
```

Verify the daemon:
```sh
pgrep -af bluetoothd     # expect /usr/bin/bluetoothd -n
```

## 5. Match the Bluetooth Name to the Linux Hostname

Align the advertised name with the system hostname so the device shows up consistently in scans.

```sh
HOSTNAME=$(uci get system.@system[0].hostname)  # example Omega-1CC0
bluetoothctl system-alias "$HOSTNAME"
bluetoothctl show | grep -i alias               # confirm Alias: Omega-1CC0
```

Notes:
- `bluetoothctl show` will still list `Name: BlueZ 5.xx`; that field comes from the controller/driver and is not changed by the alias.
- The alias is what peers see in scans/advertising. It is persisted by `bluetoothd`. If you change the system hostname later, rerun the `bluetoothctl system-alias` command to keep them in sync.

## 6. Basic Adapter Configuration

Use `bluetoothctl`:

```sh
bluetoothctl
[bluetooth]# show              # confirm Powered: yes, Roles: central/peripheral
[bluetooth]# power on          # redundant if already powered
[bluetooth]# pairable on
[bluetooth]# discoverable on   # optional, makes Omega4 visible
```

To exit the shell press `Ctrl+D` or type `quit`.

## 7. Scanning & Pairing

1. Start a timed scan (no persistent shell needed):
   ```sh
   bluetoothctl --timeout 15 scan on
   ```
   Expected log snippet:
   ```
   Controller 88:1E:59:05:02:87 Discovering: yes
   [NEW] Device 68:27:37:52:F0:E5 Laptop-Dev
   ```

2. Pair & trust a device (example MAC):
   ```sh
   bluetoothctl
   [bluetooth]# scan on
   [bluetooth]# pair 68:27:37:52:F0:E5
   [bluetooth]# trust 68:27:37:52:F0:E5
   [bluetooth]# connect 68:27:37:52:F0:E5
   ```

3. When pairing a computer, you can keep it simple: use the built-in profiles (e.g., RFCOMM for serial-like links).

## 8. Troubleshooting Tips

| Symptom | Checks |
| --- | --- |
| `hciconfig` shows `DOWN` | `hciconfig hci0 up`; inspect `dmesg | grep aic_btsdio`. |
| `bluetoothctl` lacks permissions | Ensure `bluetoothd` is running; restart via `/etc/init.d/bluetoothd restart`. |
| No devices found when scanning | Verify antennas/power, ensure `Discoverable: yes`; watch `logread -f` for SDIO errors. |
| Packages missing | Re-run `opkg update`; confirm the target feed (`targets/rockchip/cortexa7`) is reachable or mirror the `.ipk` files. |

## 9. Send Serial Data from a Host to Omega4

Use the Serial Port Profile (RFCOMM) to push simple serial-style data from a laptop to the Omega4.

1. Pair/trust the host (see steps above), ensure `bluetoothd` is running, and note the Omega4 BD_ADDR, e.g. `88:1E:59:05:02:87`.
2. On the Omega4, expose the Serial Port Profile and start a listener on channel 1:
   ```sh
   sdptool add SP                     # advertise Serial Port
   rfcomm watch hci0 1 sh -c 'cat > /tmp/bt_serial_in'
   ```
   Keep this running; it writes any received bytes into `/tmp/bt_serial_in`.
3. On the host Linux machine, create/bind an RFCOMM link to channel 1:
   - If the `rfcomm` tool is available:
     ```sh
     sudo rfcomm connect 0 88:1E:59:05:02:87 1
     echo "hello omega" > /dev/rfcomm0
     ```
   - If `rfcomm` is missing on newer BlueZ builds, either install the compat package (e.g., `sudo apt-get install bluez-compat`) or use `socat` without creating `/dev/rfcomm0`:
     ```sh
     printf "hello omega\n" | socat - "rfcomm-connect:88:1E:59:05:02:87,channel=1"
     ```
4. Back on the Omega4, confirm the data arrived:
   ```sh
   tail -f /tmp/bt_serial_in
   ```

Notes:
- If multiple connections are expected, pick a different channel number per service.
- Replace the `cat > /tmp/bt_serial_in` handler with your own app (e.g., `python3 -u recv.py` or `socat` to forward into another serial port).
- Stop the RFCOMM listener with `Ctrl+C` when finished.
- Host side: install `bluez-compat` to regain the `rfcomm` CLI, or install `socat` if using the `rfcomm-connect:` method above.

## 10. Useful Commands Summary

```sh
# Service control
/etc/init.d/bluetoothd {start|stop|restart|enable|disable}

# Adapter status
hciconfig -a
bluetoothctl show

# Scanning
bluetoothctl --timeout 15 scan on

# Logs
logread -f | grep -i bluetooth
dmesg | grep -i aic_btsdio
```
